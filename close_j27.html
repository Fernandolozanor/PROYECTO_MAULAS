<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Cerrar Jornada 27</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- App Scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/db-service.js"></script>
</head>

<body style="font-family: sans-serif; padding: 50px; text-align: center;">
    <h1>Cerrar Jornada 27</h1>
    <p>Esta acción desactivará la Jornada 27 para que ya no se puedan introducir más pronósticos.</p>
    <button id="btn-close"
        style="font-size: 20px; padding: 15px 30px; cursor: pointer; background: #c62828; color: white; border: none; border-radius: 5px;">
        CERRAR JORNADA 27
    </button>
    <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

    <script>
        const btn = document.getElementById('btn-close');
        const status = document.getElementById('status');

        btn.addEventListener('click', async () => {
            btn.disabled = true;
            btn.innerText = "Procesando...";
            status.innerText = "Conectando...";

            try {
                if (!window.DataService) await new Promise(r => setTimeout(r, 1000));
                await window.DataService.init();

                const jornadas = await window.DataService.getAll('jornadas');
                const j27 = jornadas.find(j => j.number == 27 || j.id == 27);

                if (j27) {
                    j27.active = false; // Deactivate
                    await window.DataService.save('jornadas', j27);
                    status.style.color = "green";
                    status.innerText = "¡Jornada 27 cerrada con éxito!";
                    alert("Jornada cerrada. Ya no estará disponible para nuevos pronósticos.");
                    window.location.href = 'index.html'; // Back to dashboard
                } else {
                    status.style.color = "red";
                    status.innerText = "Error: La Jornada 27 no se encontró.";
                }

            } catch (e) {
                console.error(e);
                status.style.color = "red";
                status.innerText = "Error: " + e.message;
                btn.disabled = false;
                btn.innerText = "Reintentar";
            }
        });
    </script>
</body>

</html>
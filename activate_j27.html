<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Activar Jornada 27</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- App Scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/db-service.js"></script>
</head>

<body style="font-family: sans-serif; padding: 50px; text-align: center;">
    <h1>Activar Jornada 27</h1>
    <p>Esta herramienta asegurará que la Jornada 27 esté activa para recibir pronósticos.</p>
    <button id="btn-activate"
        style="font-size: 20px; padding: 15px 30px; cursor: pointer; background: #2e7d32; color: white; border: none; border-radius: 5px;">
        ACTIVAR JORNADA 27
    </button>
    <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

    <script>
        const btn = document.getElementById('btn-activate');
        const status = document.getElementById('status');

        btn.addEventListener('click', async () => {
            btn.disabled = true;
            btn.innerText = "Procesando...";
            status.innerText = "Conectando...";

            try {
                if (!window.DataService) await new Promise(r => setTimeout(r, 1000));
                await window.DataService.init();

                const jornadas = await window.DataService.getAll('jornadas');
                const j27 = jornadas.find(j => j.number == 27 || j.id == 27);

                if (j27) {
                    j27.active = true;
                    // Ensure date is valid for the system if needed, or leave as is
                    // Just forcing active status
                    await window.DataService.save('jornadas', j27);
                    status.style.color = "green";
                    status.innerText = "¡Jornada 27 activada con éxito! Ahora puedes introducir los pronósticos.";
                    alert("Jornada 27 activada. Ve a Pronósticos para introducir datos.");
                    window.location.href = 'pronosticos.html';
                } else {
                    status.style.color = "red";
                    status.innerText = "Error: La Jornada 27 no se encontró en la base de datos.";
                }

            } catch (e) {
                console.error(e);
                status.style.color = "red";
                status.innerText = "Error: " + e.message;
                btn.disabled = false;
                btn.innerText = "Reintentar";
            }
        });
    </script>
</body>

</html>
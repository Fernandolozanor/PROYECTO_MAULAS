<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Rescatar Jornada 28</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- App Scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/db-service.js"></script>
</head>

<body style="font-family: sans-serif; padding: 50px; text-align: center;">
    <h1>Rescatar Jornada 28</h1>
    <p>El sistema detecta que la Jornada 28 tiene fecha del Lunes 15, pero el sistema está configurado para mostrar solo
        jornadas de Domingo.</p>
    <p>Esta herramienta cambiará la fecha oficial al <strong>Domingo 14 de Diciembre</strong> para que sea visible.</p>

    <button id="btn-fix"
        style="font-size: 20px; padding: 15px 30px; cursor: pointer; background: #f57c00; color: white; border: none; border-radius: 5px;">
        CORREGIR FECHA A DOMINGO
    </button>
    <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

    <script>
        const btn = document.getElementById('btn-fix');
        const status = document.getElementById('status');

        btn.addEventListener('click', async () => {
            btn.disabled = true;
            btn.innerText = "Corrigiendo...";
            status.innerText = "Buscando Jornada 28...";

            try {
                if (!window.DataService) await new Promise(r => setTimeout(r, 1000));
                await window.DataService.init();

                const jornadas = await window.DataService.getAll('jornadas');
                const j28 = jornadas.find(j => j.number == 28 || j.id == 28);

                if (j28) {
                    // FIX: Change date to Sunday 14 Dec
                    j28.date = '14 de diciembre de 2025';
                    j28.active = true; // Ensure active

                    await window.DataService.save('jornadas', j28);

                    status.style.color = "green";
                    status.innerText = "¡Fecha corregida! Ahora es 14 de Diciembre (Domingo).";
                    alert("Corrección realizada. La jornada debería aparecer ahora en Pronósticos.");
                    window.location.href = 'pronosticos.html';
                } else {
                    status.style.color = "red";
                    status.innerText = "Error: La Jornada 28 no existe en la base de datos.";
                }

            } catch (e) {
                console.error(e);
                status.style.color = "red";
                status.innerText = "Error: " + e.message;
                btn.disabled = false;
                btn.innerText = "Reintentar";
            }
        });
    </script>
</body>

</html>